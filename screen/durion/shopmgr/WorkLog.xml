<?xml version="1.0" encoding="UTF-8"?>
<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-3.xsd"
        default-menu-title="Work Logs"
        default-menu-index="3">

    <transition name="createWorkLog">
        <service-call name="durion.shopmgr.DurShopMgrServices.create#WorkLog"/>
        <default-response url="."/>
    </transition>

    <transition name="editWorkLog">
        <default-response url="../WorkLogEdit"/>
    </transition>

    <actions>
        <entity-find entity-name="durion.shopmgr.DurShopWorkLog" list="workLogList">
            <search-form-inputs default-order-by="-workDate,-startTime"/>
        </entity-find>
    </actions>

    <widgets>
        <container-dialog id="CreateWorkLogDialog" button-text="Create Work Log">
            <form-single name="CreateWorkLogForm" transition="createWorkLog">
                <field name="appointmentId"><default-field title="Appointment">
                    <drop-down allow-empty="true">
                        <entity-options entity-name="durion.shopmgr.DurShopAppointment">
                            <entity-options-option key="${appointmentId}" text="Appt ${appointmentId} - ${appointmentDate}"/>
                            <entity-find>
                                <econdition field-name="statusId" operator="in" value="APPT_IN_PROGRESS,APPT_CONFIRMED"/>
                            </entity-find>
                        </entity-options>
                    </drop-down>
                </default-field></field>
                <field name="mechanicId"><default-field title="Mechanic">
                    <drop-down>
                        <entity-options entity-name="durion.shopmgr.DurShopMechanic">
                            <entity-options-option key="${mechanicId}" text="${firstName} ${lastName}"/>
                            <entity-find>
                                <econdition field-name="statusId" value="MECHANIC_ACTIVE"/>
                            </entity-find>
                        </entity-options>
                    </drop-down>
                </default-field></field>
                <field name="workDate"><default-field><date-time type="date"/></default-field></field>
                <field name="startTime"><default-field><date-time type="date-time"/></default-field></field>
                <field name="endTime"><default-field><date-time type="date-time"/></default-field></field>
                <field name="serviceTypeId"><default-field title="Service Type">
                    <drop-down allow-empty="true">
                        <entity-options entity-name="durion.shopmgr.DurShopServiceType">
                            <entity-options-option key="${serviceTypeId}" text="${serviceTypeName}"/>
                        </entity-options>
                    </drop-down>
                </default-field></field>
                <field name="description"><default-field title="Work Performed">
                    <text-area rows="3"/>
                </default-field></field>
                <field name="billableHours"><default-field><text-line format="#0.00"/></default-field></field>
                <field name="submitButton"><default-field title="Create"><submit/></default-field></field>
            </form-single>
        </container-dialog>

        <form-list name="WorkLogList" list="workLogList" skip-form="true">
            <field name="workLogId">
                <default-field><link url="editWorkLog" text="${workLogId}" link-type="anchor"/></default-field>
            </field>
            <field name="workDate"><default-field><display format="yyyy-MM-dd"/></default-field></field>
            <field name="mechanicId"><default-field title="Mechanic">
                <display-entity entity-name="durion.shopmgr.DurShopMechanic" text="${firstName} ${lastName}"/>
            </default-field></field>
            <field name="appointmentId"><default-field title="Appointment">
                <display/>
            </default-field></field>
            <field name="startTime"><default-field><display format="HH:mm"/></default-field></field>
            <field name="endTime"><default-field><display format="HH:mm"/></default-field></field>
            <field name="hoursWorked"><default-field><display format="#0.00"/></default-field></field>
            <field name="billableHours"><default-field><display format="#0.00"/></default-field></field>
            <field name="serviceTypeId"><default-field title="Service">
                <display-entity entity-name="durion.shopmgr.DurShopServiceType" text="${serviceTypeName}"/>
            </default-field></field>
            <field name="statusId"><default-field title="Status"><display/></default-field></field>
        </form-list>
    </widgets>
</screen>
